<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="theme-color" content="#2a2a2a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="MikuMikuWorld">
    
    <title>MikuMikuWorld - Web Editor</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%23ff6b6b'/><text x='50' y='50' font-size='60' fill='white' text-anchor='middle' dominant-baseline='central'>‚ô™</text></svg>">
    <link rel="stylesheet" href="css/style.css">
    
    <style>
        /* „Ç∞„É≠„Éº„Éê„É´„Éï„ÉÉ„ÇØ */
        html.fullscreen body {
            position: fixed;
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>
<body>
    <!-- „Éò„ÉÉ„ÉÄ„Éº -->
    <header class="header">
        <h1>üéµ MikuMikuWorld Web Editor</h1>
        <div class="header-right">
            <span class="version">v1.0</span>
        </div>
    </header>

    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„Éä -->
    <div class="container">
        <!-- „Çµ„Ç§„Éâ„Éê„Éº -->
        <aside class="sidebar">
            <!-- „É°„Çø„Éá„Éº„Çø„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div class="sidebar-section">
                <div class="sidebar-title">Score Info</div>
                
                <div class="form-group">
                    <label for="title-input">Title</label>
                    <input type="text" id="title-input" placeholder="Score title">
                </div>
                
                <div class="form-group">
                    <label for="artist-input">Artist</label>
                    <input type="text" id="artist-input" placeholder="Artist name">
                </div>
                
                <div class="form-group">
                    <label for="designer-input">Designer</label>
                    <input type="text" id="designer-input" placeholder="Designer name">
                </div>

                <div class="form-group">
                    <label for="difficulty-input">Difficulty</label>
                    <input type="number" id="difficulty-input" min="0" max="15" value="0">
                </div>

                <div class="form-group">
                    <label for="playlevel-input">Play Level</label>
                    <input type="number" id="playlevel-input" min="1" max="26" value="1">
                </div>
            </div>

            <!-- „Éï„Ç°„Ç§„É´Êìç‰Ωú -->
            <div class="sidebar-section">
                <div class="sidebar-title">File</div>
                <div class="btn-group">
                    <button id="import-btn" class="btn-secondary">üìÇ Import SUS</button>
                    <button id="export-btn">üíæ Export SUS</button>
                </div>
            </div>

            <!-- ÂÜçÁîüÊìç‰Ωú -->
            <div class="sidebar-section">
                <div class="sidebar-title">Playback</div>
                <div class="btn-group">
                    <button id="play-btn">‚ñ∂ Play</button>
                    <button id="stop-btn" class="btn-secondary">‚èπ Stop</button>
                </div>
            </div>

            <!-- „ÉÑ„Éº„É´ -->
            <div class="sidebar-section">
                <div class="sidebar-title">Tools</div>
                <div class="btn-group">
                    <button id="undo-btn" class="btn-secondary" title="Undo (Ctrl+Z)">‚Ü∂ Undo</button>
                    <button id="redo-btn" class="btn-secondary" title="Redo (Ctrl+Y)">‚Ü∑ Redo</button>
                </div>
            </div>

            <!-- „Éò„É´„Éó -->
            <div class="sidebar-section">
                <div class="sidebar-title">Help</div>
                <div style="font-size: 12px; color: var(--text-muted); line-height: 1.6;">
                    <p><strong>Êìç‰ΩúÊñπÊ≥ï:</strong></p>
                    <p>‚Ä¢ „Çø„ÉÉ„Éó: „Éé„Éº„ÉÑËøΩÂä†</p>
                    <p>‚Ä¢ Wheel: „Çπ„ÇØ„É≠„Éº„É´</p>
                    <p>‚Ä¢ Ctrl+Wheel: „Ç∫„Éº„É†</p>
                    <p>‚Ä¢ Space: ÂÜçÁîü/‰∏ÄÊôÇÂÅúÊ≠¢</p>
                    <p>‚Ä¢ Delete: ÂâäÈô§</p>
                    <p>‚Ä¢ Ctrl+Z: Êàª„Åô</p>
                    <p>‚Ä¢ Ctrl+Y: „ÇÑ„ÇäÁõ¥„Åô</p>
                    <p>‚Ä¢ Ctrl+S: „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</p>
                </div>
            </div>
        </aside>

        <!-- „É°„Ç§„É≥„Ç®„É™„Ç¢ -->
        <div class="main">
            <!-- „ÉÑ„Éº„É´„Éê„Éº -->
            <div class="toolbar">
                <div class="toolbar-group">
                    <span class="toolbar-label">Zoom:</span>
                    <input type="range" id="zoom-slider" min="0.5" max="4" step="0.1" value="1" style="width: 100px;">
                    <span id="zoom-label">100%</span>
                </div>

                <div class="toolbar-group">
                    <span class="toolbar-label">BPM:</span>
                    <input type="number" id="bpm-input" min="1" max="500" value="120" style="width: 60px;">
                </div>

                <div class="toolbar-group">
                    <span class="toolbar-label">Time Sig:</span>
                    <input type="number" id="timesig-num" min="1" max="12" value="4" style="width: 50px;">
                    <span style="line-height: 32px;">/</span>
                    <input type="number" id="timesig-den" min="1" max="16" value="4" style="width: 50px;">
                </div>
            </div>

            <!-- Canvas -->
            <canvas id="timeline"></canvas>

            <!-- „Çπ„ÉÜ„Éº„Çø„Çπ„Éê„Éº -->
            <div class="statusbar">
                <div class="statusbar-left">
                    <span>Beat: <strong id="beat-display">0.00</strong></span>
                    <span>Notes: <strong id="note-count">0</strong></span>
                </div>
                <div class="statusbar-right">
                    <span id="status-message">Ready</span>
                </div>
            </div>
        </div>
    </div>

    <!-- „Çπ„ÇØ„É™„Éó„Éà -->
    <script src="js/susParser.js"></script>
    <script src="js/timelineRenderer.js"></script>
    <script src="js/editor.js"></script>

    <script>
        // ËøΩÂä†„ÅÆÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', () => {
            // Undo/Redo „Éú„Çø„É≥
            document.getElementById('undo-btn').addEventListener('click', () => {
                window.editor.undo();
            });
            document.getElementById('redo-btn').addEventListener('click', () => {
                window.editor.redo();
            });

            // „Ç∫„Éº„É†„Çπ„É©„Ç§„ÉÄ„Éº
            document.getElementById('zoom-slider').addEventListener('input', (e) => {
                const zoom = parseFloat(e.target.value);
                window.editor.ui.renderer.zoom = zoom;
                window.editor.ui.renderer.beatHeight = 80 * zoom;
                document.getElementById('zoom-label').textContent = Math.round(zoom * 100) + '%';
                window.editor.render();
            });

            // BPMÂÖ•Âäõ
            document.getElementById('bpm-input').addEventListener('change', (e) => {
                window.editor.playback.bpm = parseFloat(e.target.value) || 120;
                if (window.editor.scoreData.bpmList.length > 0) {
                    window.editor.scoreData.bpmList[0].bpm = window.editor.playback.bpm;
                }
            });

            // „Çπ„ÉÜ„Éº„Çø„ÇπÊõ¥Êñ∞
            setInterval(() => {
                document.getElementById('beat-display').textContent = window.editor.playback.currentBeat.toFixed(2);
                document.getElementById('note-count').textContent = window.editor.scoreData.notes.length;
            }, 100);

            // Service Worker ÁôªÈå≤Ôºà„Ç™„Éï„É©„Ç§„É≥ÂØæÂøúÔºâ
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js').catch(() => {
                    // Service Worker „ÅØÂøÖÈ†à„Åß„ÅØ„Å™„ÅÑ
                });
            }

            // iOS „Éë„ÉÉ„Éâ„Éû„Éº„Ç∏„É≥ÂØæÂøú
            const updateSafeArea = () => {
                const getEnv = (e) => parseInt(getComputedStyle(document.documentElement).getPropertyValue(e)) || 0;
                const paddingTop = getEnv('--safe-area-inset-top');
                const paddingBottom = getEnv('--safe-area-inset-bottom');
                
                if (paddingTop > 0) {
                    document.body.style.paddingTop = paddingTop + 'px';
                }
                if (paddingBottom > 0) {
                    document.querySelector('.statusbar').style.paddingBottom = paddingBottom + 'px';
                }
            };
            updateSafeArea();
            window.addEventListener('orientationchange', updateSafeArea);

            // „Ç≥„É≥„ÉÜ„Ç≠„Çπ„Éà„É°„Éã„É•„ÉºÁÑ°ÂäπÂåñÔºà„Çø„ÉÉ„ÉÅ„Éá„Éê„Ç§„ÇπÔºâ
            if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
                document.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                });
            }
        });

        // „Éö„Éº„Ç∏Èõ¢ËÑ±ÊôÇ„ÅÆÁ¢∫Ë™ç
        window.addEventListener('beforeunload', (e) => {
            if (window.editor && window.editor.scoreData.notes.length > 0) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
    </script>
</body>
</html>
